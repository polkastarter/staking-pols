<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/PolsStake.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> PolsStake.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">86.44% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>153/177</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">70% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>56/80</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">88.24% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>45/51</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">86.21% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>150/174</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">49×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">917×</span>
<span class="cline-any cline-yes">917×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">281×</span>
<span class="cline-any cline-yes">281×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">363×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">35×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">178×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">78×</span>
<span class="cline-any cline-yes">52×</span>
<span class="cline-any cline-yes">52×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">46×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">182×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">82×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">517×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">361×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">335×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">325×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">315×</span>
<span class="cline-any cline-yes">315×</span>
<span class="cline-any cline-yes">315×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">315×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">213×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">80×</span>
<span class="cline-any cline-yes">80×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">80×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">133×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">126×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">126×</span>
<span class="cline-any cline-yes">126×</span>
<span class="cline-any cline-yes">126×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">102×</span>
<span class="cline-any cline-yes">102×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">315×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">406×</span>
<span class="cline-any cline-yes">406×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">34×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">173×</span>
<span class="cline-any cline-yes">173×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">173×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">151×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">149×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">149×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">149×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">149×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">147×</span>
<span class="cline-any cline-yes">125×</span>
<span class="cline-any cline-yes">125×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">125×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">147×</span>
<span class="cline-any cline-yes">137×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">166×</span>
<span class="cline-any cline-yes">164×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">160×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">160×</span>
<span class="cline-any cline-yes">156×</span>
<span class="cline-any cline-yes">156×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">156×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">156×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">139×</span>
<span class="cline-any cline-yes">139×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">102×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">84×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">82×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">39×</span>
<span class="cline-any cline-yes">39×</span>
<span class="cline-any cline-yes">39×</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
pragma solidity ^0.8.12;
&nbsp;
// import "hardhat/console.sol"; // DEBUG ONLY
// import "@openzeppelin/contracts/utils/Strings.sol"; // DEBUG ONLY
&nbsp;
import "@openzeppelin/contracts/access/AccessControl.sol"; // OZ contracts v4
import "@openzeppelin/contracts/security/ReentrancyGuard.sol"; // OZ contracts v4
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // OZ contracts v4
&nbsp;
import "./IPolsStakeMigrate.sol";
&nbsp;
contract PolsStake is AccessControl, ReentrancyGuard {
    using SafeERC20 for IERC20;
    // using Strings for uint256; // DEBUG ONLY
&nbsp;
    // bytes32 public constant DEFAULT_ADMIN_ROLE = 0x00;
    bytes32 public constant BURNER_ROLE = keccak256("BURNER_ROLE");
&nbsp;
    event Stake(address indexed account, uint256 amount, uint48 stakeTime, uint48 unlockTime);
    event Withdraw(address indexed account, uint256 amount, uint48 withdrawTime);
    event Claimed(address indexed account, address indexed rewardToken, uint256 amount);
    event RewardsAdded(address indexed account, uint256 externalAccumulatedRewards);
&nbsp;
    event RewardTokenChanged(address indexed oldRewardToken, uint256 returnedAmount, address indexed newRewardToken);
    event PrevPolsStakingChanged(address indexed prevPolsStaking);
    event LockedRewardsEnabledChanged(bool lockedRewardsEnabled);
    event UnlockedRewardsFactorChanged(uint256 unlockedRewardsFactor);
    event LockTimePeriodOptionsChanged(uint32[] lockTimePeriod, uint32[] lockTimePeriodRewardFactor);
    event LockTimePeriodRewardFactorsChanged(uint32[] lockTimePeriodRewardFactor);
    event StakeRewardFactorChanged(uint256 stakeRewardFactor);
    event StakeRewardEndTimeChanged(uint48 stakeRewardEndTime);
    event RewardsBurned(address indexed staker, uint256 amount);
    event ERC20TokensRemoved(address indexed tokenAddress, address indexed receiver, uint256 amount);
&nbsp;
    uint48 public constant MAX_TIME = type(uint48).max; // = 2^48 - 1
    uint32 public constant REWARDS_DIV = 1_000_000;
&nbsp;
    struct User {
        uint48 stakeTime;
        uint48 unlockTime;
        uint32 stakePeriodRewardFactor; // 1.0 = 1 * REWARDS_DIV
        uint128 stakeAmount;
        uint256 accumulatedRewards;
    }
&nbsp;
    mapping(address =&gt; User) public userMap;
&nbsp;
    uint256 public tokenTotalStaked; // sum of all staked tokens
&nbsp;
    address public immutable stakingToken; // address of token which can be staked into this contract
    address public rewardToken; // address of reward token
    address public prevPolsStaking; // address of previously deployed PolsStaking contract (to migrate rewards from)
&nbsp;
    /**
     * Using block.timestamp instead of block.number for reward calculation
     * 1) Easier to handle for users
     * 2) Should result in same rewards across different chain with different block times
     * 3) "The current block timestamp must be strictly larger than the timestamp of the last block, ...
     *     but the only guarantee is that it will be somewhere between the timestamps ...
     *     of two consecutive blocks in the canonical chain."
     *    https://docs.soliditylang.org/en/v0.7.6/cheatsheet.html?highlight=block.timestamp#global-variables
     */
&nbsp;
    uint32[] public lockTimePeriod = [0, 7 days, 14 days, 30 days, 60 days, 90 days, 180 days, 365 days]; // time period tokens are locked after staking
    uint32[] public lockTimePeriodRewardFactor = [
        0,
        REWARDS_DIV,
        REWARDS_DIV,
        REWARDS_DIV,
        REWARDS_DIV,
        REWARDS_DIV,
        REWARDS_DIV,
        REWARDS_DIV
    ];
&nbsp;
    uint48 public stakeRewardEndTime; // unix time in seconds when the reward scheme will end
    uint256 public stakeRewardFactor; // time in seconds * amount of staked token to receive 1 reward token
&nbsp;
    // new v3 features
    bool public lockedRewardsEnabled; // upfront rewards for lock period (v2=false, v3=true)
    uint256 public unlockedRewardsFactor; // rewards multiplier outside lock period (v2=1*REWARDS_DIV , v3=0)
&nbsp;
    constructor(address _stakingToken) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_stakingToken != address(0), "stakingToken.address == 0");
&nbsp;
        stakingToken = _stakingToken;
&nbsp;
        // set some defaults
        lockedRewardsEnabled = false; // (like v2)
        unlockedRewardsFactor = 1 * REWARDS_DIV; // by default (amount * time * 1.0) rewards for staked, but unlocked tokens (like v2)
        stakeRewardFactor = 1000 * 1 days; // default : a user has to stake 1000 token for 1 day to receive 1 reward token
        stakeRewardEndTime = uint48(block.timestamp + 366 days); // default : reward scheme ends in 1 year
        _setupRole(DEFAULT_ADMIN_ROLE, msg.sender);
    }
&nbsp;
    /**
     * PolsStake v2 backwards compatibility functions (to be removed later)
     * mostly used to run v2 test (almost) unchanged on v3
     */
    function stake(uint256 _amount) external nonReentrant returns (uint256) {
        return _stakelockTimeChoice(_amount, 1); // use default index 1 which should be 7 days
    }
&nbsp;
    function getLockTimePeriod() external view returns (uint32) {
        return lockTimePeriod[1];
    }
&nbsp;
    function setLockTimePeriodDefault(uint32 _defaultLockTime) external onlyRole(DEFAULT_ADMIN_ROLE) {
        lockTimePeriod[1] = _defaultLockTime;
    }
&nbsp;
    /**
     * based on OpenZeppelin SafeCast v4.3
     * https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.3/contracts/utils/math/SafeCast.sol
     */
&nbsp;
    function toUint48(uint256 value) internal pure returns (uint48) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(value &lt;= type(uint48).max, "value does not fit in 48 bits");
        return uint48(value);
    }
&nbsp;
    function toUint128(uint256 value) internal pure returns (uint128) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(value &lt;= type(uint128).max, "value does not fit in 128 bits");
        return uint128(value);
    }
&nbsp;
    /**
     * @dev Returns the largest of two numbers.
     */
<span class="fstat-no" title="function not covered" >    function max(uint256 a, uint256 b) internal pure returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return a &gt;= b ? a : b;</span>
    }
&nbsp;
    /**
     * @dev Returns the smallest of two numbers.
     */
    function min(uint256 a, uint256 b) internal pure returns (uint256) {
        return a &lt; b ? a : b;
    }
&nbsp;
    /**
     * External API functions - account related
     */
&nbsp;
<span class="fstat-no" title="function not covered" >    function stakeTime(address _staker) external view returns (uint48 dateTime) {</span>
<span class="cstat-no" title="statement not covered" >        return userMap[_staker].stakeTime;</span>
    }
&nbsp;
    function stakeAmount(address _staker) external view returns (uint256 balance) {
        return userMap[_staker].stakeAmount;
    }
&nbsp;
    // redundant with stakeAmount() for compatibility
    function balanceOf(address _staker) external view returns (uint256 balance) {
        return userMap[_staker].stakeAmount;
    }
&nbsp;
    function userAccumulatedRewards(address _staker) external view returns (uint256 rewards) {
        return userMap[_staker].accumulatedRewards;
    }
&nbsp;
    /**
     * @dev return unix epoch time when staked tokens will be unlocked
     * @return unlockTime unix epoch time in seconds
     */
    function getUnlockTime(address _staker) public view returns (uint48 unlockTime) {
        return userMap[_staker].unlockTime;
    }
&nbsp;
    /**
     * @dev return remaining lock time period
     * @return unlockTime remaining time in seconds
     */
    function remainingLockPeriod(address _staker) public view returns (uint48) {
        uint48 unlockTime = getUnlockTime(_staker);
        if (unlockTime &lt;= block.timestamp) {
            return 0;
        } else {
            return unlockTime - toUint48(block.timestamp);
        }
    }
&nbsp;
    /**
     * DEBUG ONLY - Helper functions
     * requires solc &gt;=0.8.12
     * https://docs.soliditylang.org/en/v0.8.12/types.html#the-functions-bytes-concat-and-string-concat
     */
    /*
    function console_log_time(string memory message, uint256 t) internal view {
        uint256 t_seconds = t % 60;
        t = t / 60;
        uint256 t_minutes = t % 60;
        t = t / 60;
        uint256 t_hours = t % 24;
        t = t / 24;
        uint256 t_days = t;
        string memory timeString = string.concat(t_days.toString(), " ");
        if (t_hours &lt; 10) {
            timeString = string.concat(timeString, "0");
        }
        timeString = string.concat(timeString, t_hours.toString());
        timeString = string.concat(timeString, ":");
        if (t_minutes &lt; 10) {
            timeString = string.concat(timeString, "0");
        }
        timeString = string.concat(timeString, t_minutes.toString());
        timeString = string.concat(timeString, ":");
        if (t_seconds &lt; 10) {
            timeString = string.concat(timeString, "0");
        }
        timeString = string.concat(timeString, t_seconds.toString());
        console.log(message, timeString);
    }
    */
&nbsp;
    /**
     * External API functions - contract specific
     */
&nbsp;
    /**
     * @return balance of reward tokens held by this contract
     */
    function getRewardTokenBalance() public view returns (uint256 balance) {
        if (rewardToken == address(0)) return 0;
        balance = IERC20(rewardToken).balanceOf(address(this));
        if (stakingToken == rewardToken) {
            balance -= tokenTotalStaked;
        }
    }
&nbsp;
    /**
     * @return array of lock times the user can choose from when staking
     */
    function getLockTimePeriodOptions() external view returns (uint32[] memory) {
        return lockTimePeriod;
    }
&nbsp;
    function getLockTimePeriodRewardFactors() external view returns (uint32[] memory) {
        return lockTimePeriodRewardFactor;
    }
&nbsp;
    // onlyOwner / DEFAULT_ADMIN_ROLE functions --------------------------------------------------
&nbsp;
    function setLockedRewardsEnabled(bool _lockedRewardsEnabled) external onlyRole(DEFAULT_ADMIN_ROLE) {
        lockedRewardsEnabled = _lockedRewardsEnabled;
        emit LockedRewardsEnabledChanged(_lockedRewardsEnabled);
    }
&nbsp;
    function setUnlockedRewardsFactor(uint256 _unlockedRewardsFactor) external onlyRole(DEFAULT_ADMIN_ROLE) {
        unlockedRewardsFactor = _unlockedRewardsFactor;
        emit UnlockedRewardsFactorChanged(_unlockedRewardsFactor);
    }
&nbsp;
    /**
     * @notice setting rewardToken to address(0) disables claim/mint
     * @notice if there was a reward token set before, return remaining tokens to msg.sender/admin
     * @param newRewardToken address
     */
    function setRewardToken(address newRewardToken) external nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) {
        address oldRewardToken = rewardToken;
        uint256 rewardBalance = getRewardTokenBalance(); // balance of oldRewardToken
        if (rewardBalance &gt; 0) {
            IERC20(oldRewardToken).safeTransfer(msg.sender, rewardBalance);
        }
        rewardToken = newRewardToken;
        emit RewardTokenChanged(oldRewardToken, rewardBalance, newRewardToken);
    }
&nbsp;
    /**
     * @notice set lock time options the user can choose from when staking
     * @param _lockTimePeriod array of lock times the user can choose from when staking
     * @param _lockTimePeriodRewardFactor array of factors reward factors for each option
     */
    function setLockTimePeriodOptions(uint32[] calldata _lockTimePeriod, uint32[] calldata _lockTimePeriodRewardFactor)
        external
        onlyRole(DEFAULT_ADMIN_ROLE)
    {
        if (_lockTimePeriodRewardFactor.length == 0) {
            delete lockTimePeriodRewardFactor;
            lockTimePeriodRewardFactor.push(0); // index 0 not used
            for (uint256 i = 1; i &lt; _lockTimePeriod.length; i++) {
                lockTimePeriodRewardFactor.push(REWARDS_DIV);
            }
        } else {
            lockTimePeriodRewardFactor = _lockTimePeriodRewardFactor;
        }
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_lockTimePeriod.length == lockTimePeriodRewardFactor.length, "arrays have different lengths");
        lockTimePeriod = _lockTimePeriod;
        emit LockTimePeriodOptionsChanged(lockTimePeriod, lockTimePeriodRewardFactor);
    }
&nbsp;
    /**
     * @notice see calculateUserClaimableReward() docs
     * @dev requires that reward token has the same decimals as stake token
     * @param _stakeRewardFactor time in seconds * amount of staked token to receive 1 reward token
     */
    function setStakeRewardFactor(uint256 _stakeRewardFactor) external onlyRole(DEFAULT_ADMIN_ROLE) {
        stakeRewardFactor = _stakeRewardFactor;
        emit StakeRewardFactorChanged(_stakeRewardFactor);
    }
&nbsp;
    /**
     * @notice set block time when stake reward scheme will end
     * @param _stakeRewardEndTime unix time in seconds
     */
<span class="fstat-no" title="function not covered" >    function setStakeRewardEndTime(uint48 _stakeRewardEndTime) external onlyRole(DEFAULT_ADMIN_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(stakeRewardEndTime &gt; block.timestamp, "time has to be in the future")</span>;
<span class="cstat-no" title="statement not covered" >        stakeRewardEndTime = _stakeRewardEndTime</span>;
<span class="cstat-no" title="statement not covered" >        emit StakeRewardEndTimeChanged(_stakeRewardEndTime);</span>
    }
&nbsp;
    function setPrevPolsStaking(address _prevPolsStaking) external onlyRole(DEFAULT_ADMIN_ROLE) {
        prevPolsStaking = _prevPolsStaking;
        emit PrevPolsStakingChanged(_prevPolsStaking);
    }
&nbsp;
    /**
     * ADMIN_ROLE has to set BURNER_ROLE
     * allows an external (lottery token sale) contract to substract rewards
     */
    function burnRewards(address _staker, uint256 _amount) external onlyRole(BURNER_ROLE) {
        User storage user = _updateRewards(_staker);
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (_amount &lt; user.accumulatedRewards) {
<span class="cstat-no" title="statement not covered" >            user.accumulatedRewards -= _amount</span>; // safe
        } else {
            user.accumulatedRewards = 0; // burn at least all what's there
        }
        emit RewardsBurned(_staker, _amount);
    }
&nbsp;
    /** msg.sender external view convenience functions *********************************/
&nbsp;
    function stakeAmount_msgSender() public view returns (uint256) {
        return userMap[msg.sender].stakeAmount;
    }
&nbsp;
    function stakeTime_msgSender() external view returns (uint48) {
        return userMap[msg.sender].stakeTime;
    }
&nbsp;
    function getUnlockTime_msgSender() external view returns (uint48 unlockTime) {
        return getUnlockTime(msg.sender);
    }
&nbsp;
    function userClaimableRewards_msgSender() external view returns (uint256) {
        return userClaimableRewardsCurrent(msg.sender, false);
    }
&nbsp;
    function userAccumulatedRewards_msgSender() external view returns (uint256) {
        return userMap[msg.sender].accumulatedRewards;
    }
&nbsp;
    function userTotalRewards_msgSender() external view returns (uint256) {
        return userTotalRewards(msg.sender);
    }
&nbsp;
    function getEarnedRewardTokens_msgSender() external view returns (uint256) {
        return getEarnedRewardTokens(msg.sender);
    }
&nbsp;
    /**
     * @dev return remaining lock time period
     * @return unlockTime remaining time in seconds
     */
    function remainingLockPeriod_msgSender() external view returns (uint48) {
        return remainingLockPeriod(msg.sender);
    }
&nbsp;
    /** public external view functions (also used internally) **************************/
&nbsp;
    /**
     * calculate current rewards at time t0
     * this function is public for better testing and "what-if" UX scenarios
     *
     * We have to cover 6 cases here :
     * 1) block time &lt; stake time &lt; end time   : should never happen =&gt; error
     * 2) block time &lt; end time   &lt; stake time : should never happen =&gt; error
     * 3) end time   &lt; block time &lt; stake time : should never happen =&gt; error
     * 4) end time   &lt; stake time &lt; block time : staked after reward period is over =&gt; no rewards
     * 5) stake time &lt; block time &lt; end time   : end time in the future
     * 6) stake time &lt; end time   &lt; block time : end time in the past &amp; staked before
     * @param user_stakeAmount  amount of staked tokens
     * @param user_stakeTime    time the user has staked
     * @param user_unlockTime   time when user's staked tokens will be unlocked
     * @param t0   current block time
     * @param endTime           time when the rewards scheme will end
     * @param lockedRewards     true =&gt; user will get full rewards for lock time upfront (v3 default mode)
     * @param lockedRewardsCurrent true =&gt; only calculate locked rewards up to t0
     * @param user_stakePeriodRewardFactor is a reward factor for a given lock period option
     * @return claimableRewards rewards user has received / can claim at this block time
     */
    function _userClaimableRewardsCalculation(
        uint256 user_stakeAmount,
        uint256 user_stakeTime,
        uint256 user_unlockTime,
        uint256 t0,
        uint256 endTime,
        bool lockedRewards,
        bool lockedRewardsCurrent,
        uint256 user_stakePeriodRewardFactor
    ) public view returns (uint256) {
        if (user_stakeAmount == 0) return 0; // shortcut if user hasn't even staked anything
&nbsp;
        // case 1) 2) 3)
        // stake time in the future - should never happen - actually an (internal ?) error
        require(user_stakeTime &lt;= t0, "INTERNAL ERROR : current blocktime before staketime");
&nbsp;
        // unlockTime before staketime - should never happen - actually an (internal ?) error
        // console_log_time("user_stakeTime  (dd hh mm ss) =", user_stakeTime);
        // console_log_time("user_unlockTime (dd hh mm ss) =", user_unlockTime);
        require(user_stakeTime &lt;= user_unlockTime, "INTERNAL ERROR : unlockTime before staketime");
&nbsp;
        // case 4)
        // staked after reward period is over =&gt; no rewards
        // end time &lt; stake time &lt; block time
        if (endTime &lt;= user_stakeTime) return 0;
&nbsp;
        uint256 user_rewardEnd;
        uint256 timePeriod;
        uint256 rewards;
&nbsp;
        // conditions which are true at this point
        // - user_stakeTime &lt;= t0
        // - user_stakeTime &lt;  endTime
&nbsp;
        if (lockedRewards) {
            // v3 mode
            if (t0 &lt;= user_unlockTime) {
                // user_stakeTime &lt;= t0 &lt;= user_unlockTime
                user_rewardEnd = min(user_unlockTime, endTime); // (user_stakeTime &lt; endTime) &amp;&amp; (user_stakeTime &lt;= user_unlockTime) ===&gt; user_stakeTime &lt;= user_rewardEnd
                if (lockedRewardsCurrent) {
                    user_rewardEnd = min(user_rewardEnd, t0); // ... &amp;&amp; (user_stakeTime &lt;= to) ===&gt; user_stakeTime &lt;= user_rewardEnd
                }
                rewards =
                    ((user_rewardEnd - user_stakeTime) * user_stakeAmount * user_stakePeriodRewardFactor) /
                    REWARDS_DIV;
            } else {
                // user_stakeTime &lt;= user_unlockTime &lt; t0
                if (endTime &lt;= user_unlockTime) {
                    rewards =
                        ((endTime - user_stakeTime) * user_stakeAmount * user_stakePeriodRewardFactor) /
                        REWARDS_DIV;
                } else {
                    // user_unlockTime &lt; endTime ===&gt; get full rewards for lock period
                    rewards =
                        ((user_unlockTime - user_stakeTime) * user_stakeAmount * user_stakePeriodRewardFactor) /
                        REWARDS_DIV;
                    // check for extra rewards outside lock period
                    <span class="missing-if-branch" title="else path not taken" >E</span>if (t0 &gt; user_unlockTime) {
                        timePeriod = min(t0, endTime) - user_unlockTime;
                        rewards += (timePeriod * user_stakeAmount * unlockedRewardsFactor) / REWARDS_DIV;
                    }
                }
            }
        } else {
            // v2 mode
            timePeriod = min(t0, endTime) - user_stakeTime; // safe - see conditions above
            rewards = (timePeriod * user_stakeAmount * unlockedRewardsFactor) / REWARDS_DIV;
        }
&nbsp;
        return rewards;
    }
&nbsp;
    /**
     * calculate current reward for an account
     * @param _staker account to do the reward calculation for
     * @param lockedRewardsCurrent true =&gt; only calculate locked rewards up to block_timestamp (used for stake update)
     */
    function userClaimableRewardsCurrent(address _staker, bool lockedRewardsCurrent) public view returns (uint256) {
        User storage user = userMap[_staker];
        return
            _userClaimableRewardsCalculation(
                user.stakeAmount,
                user.stakeTime,
                user.unlockTime,
                block.timestamp,
                stakeRewardEndTime,
                lockedRewardsEnabled,
                lockedRewardsCurrent,
                user.stakePeriodRewardFactor
            );
    }
&nbsp;
    /**
     * calculate current reward for an account
     * @param _staker account to do the reward calculation for
     */
<span class="fstat-no" title="function not covered" >    function userClaimableRewards(address _staker) external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return userClaimableRewardsCurrent(_staker, false);</span>
    }
&nbsp;
    function userTotalRewards(address _staker) public view returns (uint256) {
        return userClaimableRewardsCurrent(_staker, false) + userMap[_staker].accumulatedRewards;
    }
&nbsp;
    function getEarnedRewardTokens(address _staker) public view returns (uint256 claimableRewardTokens) {
        if (address(rewardToken) == address(0) || stakeRewardFactor == 0) {
            return 0;
        } else {
            return userTotalRewards(_staker) / stakeRewardFactor; // safe
        }
    }
&nbsp;
    /**
     *  @dev whenver the staked balance changes do ...
     *
     *  @dev calculate userClaimableRewards = previous staked amount * (current time - last stake time)
     *  @dev add userClaimableRewards to userAccumulatedRewards
     *  @dev reset userClaimableRewards to 0 by setting stakeTime to current time
     *  @dev not used as doing it inline, local, within a function consumes less gas
     *
     *  @return user reference pointer for further processing
     */
    function _updateRewards(address _staker) internal returns (User storage user) {
        // calculate reward credits using previous staking amount and previous time period
        // add new reward credits to already accumulated reward credits
        user = userMap[_staker];
        user.accumulatedRewards += userClaimableRewardsCurrent(_staker, false); // do not take future, locked rewards into account !!!
&nbsp;
        // update stake Time to current time (start new reward period)
        // will also reset userClaimableRewards()
        user.stakeTime = toUint48(block.timestamp);
    }
&nbsp;
    /**
     * add stake token to staking pool
     * @dev requires the token to be approved for transfer
     * @dev we assume that (our) stake token is not malicious, so no special checks
     * @param _amount of token to be staked , if 0 then just extend lock period
     * @param lockTimeIndex index to the lockTimePeriod array , if 0 then do not change current unlockTime
     */
    function _stakelockTimeChoice(uint256 _amount, uint8 lockTimeIndex) internal returns (uint48) {
        if ((_amount == 0) &amp;&amp; (lockTimeIndex == 0)) revert("amount=0 and lockTimeIndex=0");
&nbsp;
        // User storage user = _updateRewards(msg.sender); // update rewards and return reference to user
        // calculate reward credits using previous staking amount and previous time period
        // add new reward credits to already accumulated reward credits
        User storage user = userMap[msg.sender];
        // if staking with an existing lock period, then only add rewards until current time
        // ===&gt; lockedRewardsCurrent = true
        user.accumulatedRewards += userClaimableRewardsCurrent(msg.sender, true); // do not take future, locked rewards into account !!!
&nbsp;
        // update stake Time to current time (start new reward period)
        // will also reset userClaimableRewards()
        user.stakeTime = toUint48(block.timestamp);
&nbsp;
        if (lockTimeIndex &gt; 0) {
            uint48 newUserUnlockTime = toUint48(block.timestamp + lockTimePeriod[lockTimeIndex]);
            <span class="missing-if-branch" title="else path not taken" >E</span>require(newUserUnlockTime &gt;= user.unlockTime, "new unlockTime not after current");
            user.unlockTime = newUserUnlockTime;
            user.stakePeriodRewardFactor = lockTimePeriodRewardFactor[lockTimeIndex];
        } else {
            // lockTimeIndex == 0
            // check if we are in a lock period
            <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt; user.unlockTime, "not in a lock period");
        }
&nbsp;
        if (_amount &gt; 0) {
            user.stakeAmount = toUint128(user.stakeAmount + _amount);
            tokenTotalStaked += _amount;
            // using SafeERC20 for IERC20 =&gt; will revert in case of error
            IERC20(stakingToken).safeTransferFrom(msg.sender, address(this), _amount);
        }
&nbsp;
        emit Stake(msg.sender, _amount, toUint48(block.timestamp), user.unlockTime); // = user.stakeTime
        return user.unlockTime;
    }
&nbsp;
    /**
     * Extend lock period to get more upfront rewards
     * Actually just a special case of _stakelockTimeChoice(0, lockTimeIndex)
     * @param lockTimeIndex index to the lockTimePeriod array , if 0 then do not change current unlockTime
     */
<span class="fstat-no" title="function not covered" >    function extendLockTime(uint8 lockTimeIndex) external returns (uint48) {</span>
<span class="cstat-no" title="statement not covered" >        require(lockedRewardsEnabled, "lockedRewards not enabled")</span>; // makes only sense (for the user) if lockedRewards are enabled
&nbsp;
<span class="cstat-no" title="statement not covered" >        User storage user = userMap[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        require(block.timestamp &lt; user.unlockTime, "not in a lock period")</span>;
<span class="cstat-no" title="statement not covered" >        uint48 newUserUnlockTime = toUint48(block.timestamp + lockTimePeriod[lockTimeIndex]);</span>
<span class="cstat-no" title="statement not covered" >        require(newUserUnlockTime &gt; user.unlockTime, "new unlockTime not after current")</span>;
<span class="cstat-no" title="statement not covered" >        user.unlockTime = newUserUnlockTime</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit Stake(msg.sender, 0, toUint48(block.timestamp), user.unlockTime);</span>
<span class="cstat-no" title="statement not covered" >        return user.unlockTime;</span>
    }
&nbsp;
    /**
     * Increase staked amount, but keep unlock time unchanged
     * Actually just a special case of _stakelockTimeChoice(amount, 0)
     * @param _amount of token to be staked
     */
<span class="fstat-no" title="function not covered" >    function topUp(uint256 _amount) external returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        require(_amount &gt; 0, "stake amount must be &gt; 0")</span>;
<span class="cstat-no" title="statement not covered" >        User storage user = userMap[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        user.accumulatedRewards += userClaimableRewardsCurrent(msg.sender, true)</span>; // only add rewards within lock period until this point in time
&nbsp;
        // update stake Time to current time (start new reward period)
        // will also reset userClaimableRewards()
<span class="cstat-no" title="statement not covered" >        user.stakeTime = toUint48(block.timestamp)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        user.stakeAmount = toUint128(user.stakeAmount + _amount)</span>;
<span class="cstat-no" title="statement not covered" >        tokenTotalStaked += _amount</span>;
        // using SafeERC20 for IERC20 =&gt; will revert in case of error
<span class="cstat-no" title="statement not covered" >        IERC20(stakingToken).safeTransferFrom(msg.sender, address(this), _amount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit Stake(msg.sender, _amount, toUint48(block.timestamp), user.unlockTime);</span>
<span class="cstat-no" title="statement not covered" >        return user.unlockTime;</span>
    }
&nbsp;
    /**
     * Migrate rewards from previous (v1/v2) staking contract
     */
    function migrateRewards(address _staker) public returns (uint256) {
        uint256 externalStakeAmount = IPolsStakeMigrate(prevPolsStaking).balanceOf(_staker);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(externalStakeAmount == 0, "still tokens staked");
&nbsp;
        uint256 externalAccumulatedRewards = IPolsStakeMigrate(prevPolsStaking).userAccumulatedRewards(_staker);
        require(externalAccumulatedRewards &gt; 0, "no accumulated rewards");
&nbsp;
        IPolsStakeMigrate(prevPolsStaking).burnRewards(_staker, externalAccumulatedRewards);
&nbsp;
        uint256 remainingAccumulatedRewards = IPolsStakeMigrate(prevPolsStaking).userAccumulatedRewards(_staker);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(remainingAccumulatedRewards == 0, "burn rewards failed");
        userMap[_staker].accumulatedRewards += externalAccumulatedRewards;
&nbsp;
        emit RewardsAdded(_staker, externalAccumulatedRewards);
        return externalAccumulatedRewards;
    }
&nbsp;
    function migrateRewards_msgSender() external returns (uint256) {
        return migrateRewards(msg.sender);
    }
&nbsp;
    /**
     * Internal declared functions
     */
&nbsp;
    /**
     * withdraw staked token, ...
     * do not withdraw rewards token (it might not be worth the gas)
     * @return amount of tokens sent to user's account
     */
    function _withdraw(uint256 amount) internal returns (uint256) {
        require(amount &gt; 0, "staked amount is 0");
        require(block.timestamp &gt; getUnlockTime(msg.sender), "staked tokens are still locked");
&nbsp;
        User storage user = _updateRewards(msg.sender); // update rewards and return reference to user
&nbsp;
        require(amount &lt;= user.stakeAmount, "withdraw amount &gt; staked amount");
        user.stakeAmount -= toUint128(amount);
        tokenTotalStaked -= amount;
&nbsp;
        user.unlockTime = toUint48(block.timestamp); // make sure : stakeTime &lt;= unlockTime
&nbsp;
        // using SafeERC20 for IERC20 =&gt; will revert in case of error
        IERC20(stakingToken).safeTransfer(msg.sender, amount);
&nbsp;
        emit Withdraw(msg.sender, amount, toUint48(block.timestamp)); // = user.stakeTime
        return amount;
    }
&nbsp;
    /**
     * claim reward tokens for accumulated reward credits
     * ... but do not unstake staked token
     */
    function _claim() internal returns (uint256) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(rewardToken != address(0), "no reward token contract");
        uint256 earnedRewardTokens = getEarnedRewardTokens(msg.sender);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(earnedRewardTokens &gt; 0, "no tokens to claim");
&nbsp;
        // like _updateRewards() , but reset all rewards to 0
        User storage user = userMap[msg.sender];
        user.accumulatedRewards = 0;
        user.stakeTime = toUint48(block.timestamp); // will reset userClaimableRewards to 0
        // user.stakeAmount = unchanged
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(earnedRewardTokens &lt;= getRewardTokenBalance(), "not enough reward tokens"); // redundant but dedicated error message
        IERC20(rewardToken).safeTransfer(msg.sender, earnedRewardTokens);
&nbsp;
        emit Claimed(msg.sender, rewardToken, earnedRewardTokens);
        return earnedRewardTokens;
    }
&nbsp;
    /**
     * @notice stake token
     * @param _amount of tokens to stake
     * @param _lockTimeIndex to choose lock time
     */
    function stakelockTimeChoice(uint256 _amount, uint8 _lockTimeIndex) external nonReentrant returns (uint256) {
        return _stakelockTimeChoice(_amount, _lockTimeIndex);
    }
&nbsp;
    function claim() external nonReentrant returns (uint256) {
        return _claim();
    }
&nbsp;
    function withdraw(uint256 amount) external nonReentrant returns (uint256) {
        return _withdraw(amount);
    }
&nbsp;
    function withdrawAll() external nonReentrant returns (uint256) {
        return _withdraw(stakeAmount_msgSender());
    }
&nbsp;
    /**
     * Do not accept accidently sent ETH :
     * If neither a receive Ether nor a payable fallback function is present,
     * the contract cannot receive Ether through regular transactions and throws an exception.
     * https://docs.soliditylang.org/en/v0.8.7/contracts.html#receive-ether-function
     */
&nbsp;
    /**
     * @notice withdraw accidently sent ERC20 tokens
     * @param _tokenAddress address of token to withdraw
     */
    function removeOtherERC20Tokens(address _tokenAddress) external onlyRole(DEFAULT_ADMIN_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_tokenAddress != address(stakingToken), "can not withdraw staking token");
        uint256 balance = IERC20(_tokenAddress).balanceOf(address(this));
        IERC20(_tokenAddress).safeTransfer(msg.sender, balance);
        emit ERC20TokensRemoved(_tokenAddress, msg.sender, balance);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Jun 30 2022 22:35:12 GMT+1000 (Australian Eastern Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
